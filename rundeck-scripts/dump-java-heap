#!/bin/bash
set -e -o pipefail
source "$(dirname $0)/functions"

node_pid="$(docker inspect -f '{{.State.Pid}}' rnode || echo 0)"
if (( node_pid == 0 )); then
	echo "Node is not running" >&2
	exit 1
fi

check_diag_directory
out_file="$DIAG_DIR/heapdump.$(get_current_timestamp).hprof"

logcmd jcmd $node_pid GC.heap_dump "$out_file"
sync-diag-dir
